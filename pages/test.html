<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link href="/style.css"  rel="stylesheet">
    <title id="tabTitle">TEST PLACE</title>
    <link rel="manifest" href="/site.webmanifest">
</head>
<body style="overflow-x: hidden;">
    <pre id="testPre" style="width: 100%; font-size: 24px; line-height: 150%;"></pre>
</body>
</html>
<script>
  
const testPre = document.getElementById("testPre");

// const docUrl = 'https://docs.google.com/document/d/e/2PACX-1vTMOmshQe8YvaRXi6gEPKKlsC6UpFJSMAk4mQjLm_u1gmHdVVTaeh7nBNFBRlui0sTZ-snGwZM4DBCT/pub';
const docUrl = 'https://docs.google.com/document/d/e/2PACX-1vRPzbNQcx5UriHSbZ-9vmsTow_R6RRe7eyAU60xIF9Dlz-vaHiHNO2TKgDi7jy4ZpTpNqM7EvEcfr_p/pub';

async function fetchAndParseGoogleDoc(pubUrl) {
  const html = await fetch(pubUrl).then(res => res.text());
  const parser = new DOMParser();
  const doc = parser.parseFromString(html, "text/html");

  doc.querySelectorAll("style, script").forEach(el => el.remove());

  const container = doc.querySelector(".doc-content") || doc.body;
  const lines = htmlToLines(container);

  console.log("Split lines:", lines);

  return parseCoordinates(lines);
}

function htmlToLines(element) {
  let html = element.innerHTML
    .replace(/<br\s*\/?>/gi, "\n")
    .replace(/<\/p>/gi, "\n");
  let text = html.replace(/<[^>]+>/g, "");
  return text
    .split("\n")
    .map(l => l.trim().replace(/\u00A0/g, ""))
    .filter(l => l.length);
}

function parseCoordinates(lines) {
  const startIndex = lines.findIndex(line => /^[0-9]+$/.test(line));
  const coords = [];
  for (let i = startIndex; i < lines.length; i += 3) {
    const x = Number(lines[i]);
    const char = lines[i + 1];
    const y = Number(lines[i + 2]);
    if (!isNaN(x) && char && !isNaN(y)) {
      coords.push({ x, char, y });
    }
  }
  return coords;
}

function renderGrid(coords) {
  const maxX = Math.max(...coords.map(c => c.x));
  const maxY = Math.max(...coords.map(c => c.y));
  
  const grid = Array.from({ length: maxY + 1 }, () =>
  Array.from({ length: maxX + 1 }, () => " ")
  );
  
  coords.forEach(({ x, y, char }) => {
    grid[maxY - y][x] = char;
  });
  
  return grid.map(row => row.join("")).join("\n");
}

fetchAndParseGoogleDoc(docUrl)
  .then(data => {
    let output = data.map(row => `${row.x} ${row.char} ${row.y}`).join("\n");
    testPre.textContent = renderGrid(data);
    console.log(data)
  })
  .catch(err => console.error(err));

</script>